<div class="tweet-detail-wrapper">
  <div class="tweet-detail-box">
    <% if @tweet.image.attached? %>
      <%= image_tag @tweet.image, class: "detail-image" %>
    <% end %>

    <div class="detail-line">
      <p class="spot-name"><%= @tweet.name %></p>
    </div>
    <div class="detail-line">
      <p><strong>おすすめポイント：</strong><br><%= @tweet.detail %></p>
    </div>
    <div class="detail-line">
      <p><strong>所在地：</strong><br><%= @tweet.adress %></p>
    </div>
    <div class="detail-line">
      <p><strong>所要時間：</strong><br><%= @tweet.time %> 時間</p>
    </div>
    <div class="detail-line">
      <p><strong>費用：</strong><br><%= @tweet.cost %> 万円</p>
    </div>
    <div class="detail-line">
      <p><strong>アクセス：</strong><br><%= @tweet.access %></p>
    </div>

    <div class="tag-group">
      <% @tweet.tags.each do |tag| %>
        <span class="tag-badge">#<%= tag.name %></span>
      <% end %>
    </div>




    <div id="map" style="height: 300px;"
     data-latitude="<%= @tweet.lat %>"
     data-longitude="<%= @tweet.lng %>"></div>
  
    <script>
      function initShowMap() {
        const mapElement = document.getElementById("map");
        if (!mapElement) return;

        const lat = parseFloat(mapElement.dataset.latitude);
        const lng = parseFloat(mapElement.dataset.longitude);

        const map = new google.maps.Map(mapElement, {
          zoom: 14,
          center: { lat: lat, lng: lng }
        });

        new google.maps.Marker({
          position: { lat: lat, lng: lng },
          map: map
        });
      }
    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCRKeozR0WtnEJnb3MDcsmgHMWp-2LEe4o&callback=initShowMap" async defer></script>




    <div class="like-section">
      <% if user_signed_in? %>
        <% if current_user.already_liked?(@tweet) %>
          <%= button_to tweet_like_path(@tweet), method: :delete, class: "like-button" do %>
            <i class="fas fa-heart"></i><%= @tweet.likes.count %>
          <% end %>
        <% else %>
          <%= button_to tweet_likes_path(@tweet), method: :post, class: "like-button" do %>
            🤍 <%= @tweet.likes.count %>
          <% end %>
        <% end %>
      <% else %>
        🤍 <%= @tweet.likes.count %>
      <% end %>
    </div>
  </div>

  <div class="comment-wrapper">
    <h4>コメント</h4>
    <% @comments.each do |c| %>
      <div class="comment-box">
        <p class="comment-date"><%= c.created_at.in_time_zone('Asia/Tokyo').strftime("%Y年%m月%d日 %H:%M") %></p>
        <p class="comment-content"><%= c.content %></p>
      </div>
    <% end %>

    <% if user_signed_in? %>
      <%= form_with(model: [@tweet, @comment], local: true) do |f| %>
        <%= f.text_area :content, class: "comment-field" %>
        <%= button_tag type: "submit", class: "comment-button" do %>
          💬 コメントする
        <% end %>
      <% end %>
    <% end %>
  </div>

  <div class="back-links">
    <%= link_to "編集する", edit_tweet_path(@tweet.id), class: "cute-link" %>
    <%= link_to "削除する", tweet_path(@tweet.id), method: :delete, data: { confirm: "本当に削除しますか？" }, class: "cute-link delete" %>
    <%= link_to "一覧に戻る", tweets_path, class: "cute-link" %>
  </div>
</div>