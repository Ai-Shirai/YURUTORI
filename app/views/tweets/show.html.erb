<div class="tweet-detail-wrapper">
  <div class="tweet-detail-box">
    <% if @tweet.image.attached? %>
      <%= image_tag @tweet.image, class: "detail-image" %>
    <% end %>

    <div class="detail-line">
      <p class="spot-name"><%= @tweet.name %></p>
    </div>
    <div class="detail-line">
      <p><strong>ãŠã™ã™ã‚ãƒã‚¤ãƒ³ãƒˆï¼š</strong><br><%= @tweet.detail %></p>
    </div>
    <div class="detail-line">
      <p><strong>æ‰€åœ¨åœ°ï¼š</strong><br><%= @tweet.adress %></p>
    </div>
    <div class="detail-line">
      <p><strong>æ‰€è¦æ™‚é–“ï¼š</strong><br><%= @tweet.time %> æ™‚é–“</p>
    </div>
    <div class="detail-line">
      <p><strong>è²»ç”¨ï¼š</strong><br><%= @tweet.cost %> ä¸‡å††</p>
    </div>
    <div class="detail-line">
      <p><strong>ã‚¢ã‚¯ã‚»ã‚¹ï¼š</strong><br><%= @tweet.access %></p>
    </div>

    <div class="tag-group">
      <% @tweet.tags.each do |tag| %>
        <span class="tag-badge">#<%= tag.name %></span>
      <% end %>
    </div>




    <div id="map" style="height: 300px;"
     data-latitude="<%= @tweet.lat %>"
     data-longitude="<%= @tweet.lng %>"></div>
  
    <script>
      function initShowMap() {
        const mapElement = document.getElementById("map");
        if (!mapElement) return;

        const lat = parseFloat(mapElement.dataset.latitude);
        const lng = parseFloat(mapElement.dataset.longitude);

        const map = new google.maps.Map(mapElement, {
          zoom: 14,
          center: { lat: lat, lng: lng }
        });

        new google.maps.Marker({
          position: { lat: lat, lng: lng },
          map: map
        });
      }
    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCRKeozR0WtnEJnb3MDcsmgHMWp-2LEe4o&callback=initShowMap" async defer></script>




    <div class="like-section">
      <% if user_signed_in? %>
        <% if current_user.already_liked?(@tweet) %>
          <%= button_to tweet_like_path(@tweet), method: :delete, class: "like-button" do %>
            <i class="fas fa-heart"></i><%= @tweet.likes.count %>
          <% end %>
        <% else %>
          <%= button_to tweet_likes_path(@tweet), method: :post, class: "like-button" do %>
            ğŸ¤ <%= @tweet.likes.count %>
          <% end %>
        <% end %>
      <% else %>
        ğŸ¤ <%= @tweet.likes.count %>
      <% end %>
    </div>
  </div>

  <div class="comment-wrapper">
    <h4>ã‚³ãƒ¡ãƒ³ãƒˆ</h4>
    <% @comments.each do |c| %>
      <div class="comment-box">
        <p class="comment-date"><%= c.created_at.in_time_zone('Asia/Tokyo').strftime("%Yå¹´%mæœˆ%dæ—¥ %H:%M") %></p>
        <p class="comment-content"><%= c.content %></p>
      </div>
    <% end %>

    <% if user_signed_in? %>
      <%= form_with(model: [@tweet, @comment], local: true) do |f| %>
        <%= f.text_area :content, class: "comment-field" %>
        <%= button_tag type: "submit", class: "comment-button" do %>
          ğŸ’¬ ã‚³ãƒ¡ãƒ³ãƒˆã™ã‚‹
        <% end %>
      <% end %>
    <% end %>
  </div>

  <div class="back-links">
    <%= link_to "ç·¨é›†ã™ã‚‹", edit_tweet_path(@tweet.id), class: "cute-link" %>
    <%= link_to "å‰Šé™¤ã™ã‚‹", tweet_path(@tweet.id), method: :delete, data: { confirm: "æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ" }, class: "cute-link delete" %>
    <%= link_to "ä¸€è¦§ã«æˆ»ã‚‹", tweets_path, class: "cute-link" %>
  </div>
</div>